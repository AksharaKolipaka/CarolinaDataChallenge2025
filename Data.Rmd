---
title: "Space Economy Districts - Simplified Analysis"
author: "Space Economy Analyst"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Load Required Libraries

```{r libraries}
library(tidyverse)
library(janitor)
library(readr)
library(knitr)
```

## 1. Data Import and Cleaning Functions

```{r import_functions}
# Function to read and clean individual CSV files
read_and_clean_table <- function(file_path, table_name) {
  
  # Read CSV
  raw_data <- read_csv(file_path, show_col_types = FALSE)
  
  # Get years from row 5
  years <- raw_data[5, 3:ncol(raw_data)] %>% 
    unlist() %>% 
    as.character() %>% 
    na.omit()
  
  # Clean data starting from row 6
  clean_data <- raw_data %>%
    slice(6:n()) %>%
    select(1:(length(years) + 2)) %>%
    set_names(c("row_id", "industry", years)) %>%
    filter(!is.na(industry), 
           !str_detect(industry, "^\\.\\.\\.$")) %>%
    mutate(table_name = table_name) %>%
    # Convert year columns to numeric
    mutate(across(all_of(years), ~as.numeric(str_replace_all(.x, "[^0-9.-]", "")))) %>%
    # Remove empty rows
    filter(if_any(all_of(years), ~!is.na(.x) & .x != 0))
  
  return(clean_data)
}

# Import all business tables
import_all_tables <- function() {
  
  table_files <- list(
    "Business_Table 1.csv" = "real_value_added",
    "Business_Table 2.csv" = "current_value_added", 
    "Business_Table 3.csv" = "price_indexes",
    "Business_Table 4.csv" = "real_gross_output",
    "Business_Table 5.csv" = "current_gross_output",
    "Business_Table 6.csv" = "gross_output_price_indexes",
    "Business_Table 7.csv" = "employment",
    "Business_Table 8.csv" = "compensation"
  )
  
  # Read each table separately
  all_tables <- map2(names(table_files), table_files, 
                     ~read_and_clean_table(.x, .y))
  names(all_tables) <- table_files
  
  return(all_tables)
}
```

## 2. District Classification System

```{r district_system}
# Define the 12 Hunger Games Districts (Maritime district removed)
create_district_definitions <- function() {
  tibble(
    district_number = c(1, 2, 3, 5, 6, 7, 8, 9, 10, 11, 12, 13),
    district_name = c(
      "Luxury", "Weapons", "Technology", "Power", 
      "Transportation", "Lumber", "Textiles", "Grain", 
      "Livestock", "Agriculture", "Mining", "Underground"
    ),
    district_keywords = c(
      "Satellite,Communication,Broadcasting,Telecommunication,Tourism,Wireless",
      "Defense,Military,Weapon,Aerospace Defense,Missile,Combat",
      "Computer,Software,Semiconductor,Electronic,Data Processing,Internet",
      "Electric,Power,Utilities,Energy,Solar,Oil,Gas",
      "Transportation,Logistics,Warehousing,Courier,Air,Transit",
      "Wood,Forestry,Paper,Earth Observation,Mapping,Geospatial",
      "Textile,Apparel,Manufacturing,Materials,Chemical,Plastics",
      "Food,Agriculture,Crop,Grain,Beverage,Processing",
      "Animal,Livestock,Biological,Life Sciences,Medical,Pharmaceutical",
      "Environmental,Climate,Weather,Atmospheric,Conservation",
      "Mining,Extraction,Coal,Metal,Mineral,Quarrying",
      "Other,Miscellaneous,Unknown,Research,Development"
    )
  )
}

# Function to classify industries into districts
classify_industries <- function(industries) {
  
  districts <- create_district_definitions()
  
  # Create industry classification
  industry_classification <- tibble(
    industry = industries,
    industry_clean = str_trim(str_to_title(industries)),
    district_number = NA_integer_,
    district_name = NA_character_
  )
  
  # Classify each industry
  for(i in 1:nrow(industry_classification)) {
    industry_text <- tolower(industry_classification$industry_clean[i])
    best_match <- 13  # Default to District 13 (Underground)
    best_score <- 0
    
    for(d in 1:12) {  # Check districts 1-12
      keywords <- str_split(districts$district_keywords[d], ",")[[1]]
      keywords <- tolower(str_trim(keywords))
      
      # Calculate match score
      matches <- sum(str_detect(industry_text, keywords))
      if(matches > best_score) {
        best_score <- matches
        best_match <- d
      }
    }
    
    industry_classification$district_number[i] <- best_match
    industry_classification$district_name[i] <- districts$district_name[best_match]
  }
  
  return(industry_classification)
}
```

## 3. Process Data

```{r process_data}
# Import all tables
cat("Importing business tables...\n")
business_tables <- import_all_tables()

# Get unique industries from all tables
all_industries <- unique(unlist(map(business_tables, ~.x$industry)))
cat("Total unique industries found:", length(all_industries), "\n\n")

# Classify industries into districts
cat("Classifying industries into 13 districts...\n")
industry_to_district <- classify_industries(all_industries)

# Display district distribution
district_summary <- industry_to_district %>%
  count(district_number, district_name) %>%
  arrange(district_number)

kable(district_summary, 
      caption = "Industry Distribution Across Districts",
      col.names = c("District #", "District Name", "Number of Industries"))
```

## 4. Clean Business Tables for Analysis

```{r clean_tables}
# Function to clean each business table for analysis
clean_business_table <- function(table_data, industry_mapping) {
  
  # Get year columns
  year_cols <- names(table_data)[str_detect(names(table_data), "^20")]
  
  # Join with district mapping
  cleaned <- table_data %>%
    left_join(industry_mapping %>% 
              select(industry, district_number, district_name),
              by = "industry") %>%
    # Reshape to long format for easier analysis
    pivot_longer(cols = all_of(year_cols),
                 names_to = "year",
                 values_to = "value") %>%
    mutate(year = as.numeric(year),
           value = as.numeric(value)) %>%
    filter(!is.na(value)) %>%
    select(table_name, industry, district_number, district_name, 
           year, value)
  
  return(cleaned)
}

# Clean all business tables
cleaned_business_tables <- map(business_tables, 
                               ~clean_business_table(.x, industry_to_district))

# Combine into a single analysis dataset
analysis_dataset <- bind_rows(cleaned_business_tables)

cat("\nCleaned data summary:\n")
cat("Total records:", nrow(analysis_dataset), "\n")
cat("Years covered:", min(analysis_dataset$year), "-", max(analysis_dataset$year), "\n")
cat("Tables included:", length(unique(analysis_dataset$table_name)), "\n")
```

## 5. Create Summary Tables

```{r summary_tables}
# Create district performance summary for each business table
district_performance <- analysis_dataset %>%
  filter(year == max(year)) %>%  # Latest year only
  group_by(table_name, district_number, district_name) %>%
  summarise(
    total_value = sum(value, na.rm = TRUE),
    avg_value = mean(value, na.rm = TRUE),
    industry_count = n_distinct(industry),
    .groups = "drop"
  ) %>%
  arrange(table_name, desc(total_value))

# Display top districts by real value added
top_districts <- district_performance %>%
  filter(table_name == "real_value_added") %>%
  arrange(desc(total_value)) %>%
  head(10)

kable(top_districts,
      caption = "Top 10 Districts by Real Value Added (Latest Year)",
      col.names = c("Table", "District #", "District Name", 
                   "Total Value", "Avg Value", "Industries"),
      digits = 0)
```

## 6. Export Results

```{r export_results}
# 1. Industry to District Mapping (Main Request)
write_csv(industry_to_district, "industry_district_mapping.csv")
cat("\nExported: industry_district_mapping.csv\n")

# Display sample of the mapping
cat("\nSample of Industry to District Mapping:\n")
industry_to_district %>%
  arrange(district_number) %>%
  head(20) %>%
  kable(caption = "Industry to District Assignments (First 20)")

# 2. Cleaned Business Tables (Saved separately for further analysis)
for(table_name in names(cleaned_business_tables)) {
  filename <- paste0("cleaned_", table_name, ".csv")
  write_csv(cleaned_business_tables[[table_name]], filename)
  cat("Exported:", filename, "\n")
}

# 3. Combined analysis dataset
write_csv(analysis_dataset, "all_tables_combined.csv")
cat("Exported: all_tables_combined.csv\n")

# 4. District definitions reference
write_csv(create_district_definitions(), "district_definitions.csv")
cat("Exported: district_definitions.csv\n")

cat("\n=== DATA PROCESSING COMPLETE ===\n")
cat("Main outputs:\n")
cat("1. industry_district_mapping.csv - Shows which industry went to which district\n")
cat("2. cleaned_[table_name].csv - Individual cleaned business tables\n")
cat("3. all_tables_combined.csv - All tables combined for analysis\n")
cat("4. district_definitions.csv - District reference information\n")
```

## 7. Quick Data Validation

```{r validation}
# Check for unclassified industries
unclassified <- industry_to_district %>%
  filter(district_number == 13) %>%
  nrow()

cat("\nData Quality Check:\n")
cat("Total industries:", nrow(industry_to_district), "\n")
cat("Classified to specific districts (1-12):", 
    nrow(industry_to_district) - unclassified, "\n")
cat("Unclassified (District 13):", unclassified, "\n")
cat("Classification rate:", 
    round((1 - unclassified/nrow(industry_to_district)) * 100, 1), "%\n")

# Show district balance
cat("\nDistrict Balance:\n")
industry_to_district %>%
  count(district_name) %>%
  mutate(percentage = round(n/sum(n) * 100, 1)) %>%
  arrange(desc(n)) %>%
  kable(col.names = c("District", "Industries", "Percentage"))
```


```{r bea_parent_districts}
library(tidyverse)
library(knitr)
library(scales)
library(DT)

# Helper function to calculate CAGR
calculate_cagr <- function(start_value, end_value, years) {
  if(start_value <= 0 | end_value <= 0 | years <= 0) return(0)
  ((end_value / start_value)^(1/years) - 1) * 100
}

cat("Using BEA Parent Categories as Economic Districts...\n")

# Define the major BEA parent categories as our "districts"
bea_districts <- tibble(
  district_id = 1:12,
  district_name = c(
    "Mining", 
    "Manufacturing",
    "Wholesale Trade",
    "Retail Trade", 
    "Transportation & Warehousing",
    "Information",
    "Finance & Real Estate",
    "Professional Services", 
    "Educational & Health Services",
    "Arts & Entertainment",
    "Government - Federal",
    "Government - State & Local"
  ),
  parent_category = c(
    "Mining",
    "Manufacturing", 
    "Wholesale trade",
    "Retail trade",
    "Transportation and warehousing", 
    "Information",
    "Finance, insurance, real estate, rental, and leasing",
    "Professional and business services",
    "Educational services, health care, and social assistance", 
    "Arts, entertainment, recreation, accommodation, and food services",
    "Federal",
    "State and local"
  )
)

# Function to assign industries to BEA districts
assign_bea_district <- function(industry_name) {
  industry_lower <- tolower(industry_name)
  
  # Mining sector
  if(grepl("oil and gas extraction|mining, except oil and gas|support activities for mining", industry_lower)) {
    return(list(id = 1, name = "Mining"))
  }
  # Manufacturing sector (all specific manufacturing industries)
  else if(grepl("wood products|nonmetallic mineral|primary metals|fabricated metal|machinery|computer.*electronic|electrical equipment|motor vehicles|other transportation equipment|furniture|miscellaneous manufacturing|food and beverage|textile|apparel|paper|printing|petroleum|chemical|plastics", industry_lower)) {
    return(list(id = 2, name = "Manufacturing"))
  }
  # Wholesale Trade
  else if(grepl("wholesale", industry_lower) && !grepl("retail", industry_lower)) {
    return(list(id = 3, name = "Wholesale Trade"))
  }
  # Retail Trade  
  else if(grepl("motor vehicle and parts dealers|food and beverage stores|general merchandise|other retail", industry_lower)) {
    return(list(id = 4, name = "Retail Trade"))
  }
  # Transportation & Warehousing
  else if(grepl("air transportation|rail transportation|water transportation|truck transportation|transit.*ground|pipeline transportation|warehousing", industry_lower)) {
    return(list(id = 5, name = "Transportation & Warehousing"))
  }
  # Information
  else if(grepl("publishing.*software|motion picture|broadcasting.*telecommunications|data processing.*internet", industry_lower)) {
    return(list(id = 6, name = "Information"))
  }
  # Finance & Real Estate
  else if(grepl("federal reserve|securities.*commodity|insurance carriers|real estate|housing|rental.*leasing", industry_lower)) {
    return(list(id = 7, name = "Finance & Real Estate"))
  }
  # Professional Services
  else if(grepl("legal services|computer systems design|miscellaneous professional|management.*companies|administrative.*support", industry_lower)) {
    return(list(id = 8, name = "Professional Services"))
  }
  # Educational & Health Services
  else if(grepl("educational services|ambulatory.*care|hospitals|nursing.*residential", industry_lower)) {
    return(list(id = 9, name = "Educational & Health Services"))
  }
  # Arts & Entertainment
  else if(grepl("performing arts|amusements.*gambling|accommodation|food services", industry_lower)) {
    return(list(id = 10, name = "Arts & Entertainment"))
  }
  # Federal Government
  else if(grepl("national defense|nondefense", industry_lower)) {
    return(list(id = 11, name = "Government - Federal"))
  }
  # State & Local Government
  else if(grepl("government enterprises", industry_lower)) {
    return(list(id = 12, name = "Government - State & Local"))
  }
  # Utilities (add as additional category)
  else if(grepl("utilities", industry_lower)) {
    return(list(id = 1, name = "Mining"))  # Group with Mining/Energy
  }
  # Construction
  else if(grepl("construction", industry_lower)) {
    return(list(id = 2, name = "Manufacturing"))  # Group with Manufacturing
  }
  else {
    return(list(id = 8, name = "Professional Services"))  # Default to Professional Services
  }
}

# Apply BEA district classification to the cleaned data
analysis_bea_districts <- analysis_dataset %>%
  rowwise() %>%
  mutate(
    district_info = list(assign_bea_district(industry)),
    district_id = district_info$id,
    district_name = district_info$name
  ) %>%
  select(-district_info, -district_number) %>%  # Remove old district columns
  ungroup()

cat("Industries classified into", n_distinct(analysis_bea_districts$district_id), "BEA districts\n")

# Show district distribution
district_distribution <- analysis_bea_districts %>%
  distinct(industry, district_id, district_name) %>%
  count(district_id, district_name) %>%
  arrange(district_id)

cat("\nBEA District Distribution:\n")
print(kable(district_distribution, 
            col.names = c("District ID", "District Name", "Number of Industries")))
```

## 9. Calculate Investment Metrics by BEA District

```{r bea_investment_metrics}
# Enhanced sector classification for BEA districts
classify_sector_type <- function(industry_name, district_name) {
  if(grepl("Government", district_name)) {
    return("Government")
  } else {
    return("Private")
  }
}

# Calculate investment metrics for each BEA district
calculate_bea_district_metrics <- function(district_data, district_name) {
  
  # Get latest year
  latest_year <- max(district_data$year, na.rm = TRUE)
  
  # 1. Total Economic Output
  total_output <- district_data %>%
    filter(table_name == "current_value_added", year == latest_year) %>%
    summarise(total = sum(value, na.rm = TRUE)) %>%
    pull(total)
  
  # 2. Employment (if available)
  total_employment <- district_data %>%
    filter(table_name == "employment", year == latest_year) %>%
    summarise(total = sum(value, na.rm = TRUE)) %>%
    pull(total)
  if(length(total_employment) == 0) total_employment <- 0
  
  # 3. Government vs Private classification
  is_government <- grepl("Government", district_name)
  government_output <- if(is_government) total_output else 0
  private_output <- if(!is_government) total_output else 0
  private_share <- if(!is_government) 1 else 0
  
  # 4. Growth rate (2020 to latest year)
  growth_data <- district_data %>%
    filter(table_name == "current_value_added", 
           year %in% c(2020, latest_year)) %>%
    group_by(year) %>%
    summarise(total = sum(value, na.rm = TRUE), .groups = 'drop') %>%
    arrange(year)
  
  growth_rate <- if(nrow(growth_data) >= 2 && growth_data$total[1] > 0) {
    calculate_cagr(growth_data$total[1], growth_data$total[nrow(growth_data)], nrow(growth_data) - 1)
  } else {
    0
  }
  
  # 5. High-value activities (tech/manufacturing focus)
  high_value_ratio <- case_when(
    district_name == "Manufacturing" ~ 
      (district_data %>%
       filter(table_name == "current_value_added", year == latest_year,
              grepl("computer.*electronic|other transportation equipment", tolower(industry))) %>%
       summarise(hv = sum(value, na.rm = TRUE)) %>% pull(hv)) / max(total_output, 1) * 100,
    district_name == "Professional Services" ~ 
      (district_data %>%
       filter(table_name == "current_value_added", year == latest_year,
              grepl("computer systems design", tolower(industry))) %>%
       summarise(hv = sum(value, na.rm = TRUE)) %>% pull(hv)) / max(total_output, 1) * 100,
    district_name == "Information" ~ 
      (district_data %>%
       filter(table_name == "current_value_added", year == latest_year,
              grepl("broadcasting.*telecommunications|data processing", tolower(industry))) %>%
       summarise(hv = sum(value, na.rm = TRUE)) %>% pull(hv)) / max(total_output, 1) * 100,
    TRUE ~ 0
  )
  
  # 6. Recovery analysis (2019-2020-latest)
  recovery_data <- district_data %>%
    filter(table_name == "current_value_added", 
           year %in% c(2019, 2020, latest_year)) %>%
    group_by(year) %>%
    summarise(total = sum(value, na.rm = TRUE), .groups = 'drop') %>%
    arrange(year)
  
  recovery_speed <- 0
  if(nrow(recovery_data) >= 3) {
    output_2019 <- recovery_data$total[recovery_data$year == 2019]
    output_2020 <- recovery_data$total[recovery_data$year == 2020]
    
    if(length(output_2019) > 0 && length(output_2020) > 0 && output_2019[1] > 0) {
      decline <- max(0, (output_2019[1] - output_2020[1]) / output_2019[1])
      if(decline > 0.01 && total_output >= output_2019[1] * 0.95) {
        recovery_speed <- 2 / decline  # Faster recovery = higher score
      } else if(decline > 0.01) {
        recovery_speed <- 1 / decline
      }
    }
  }
  
  # Calculate investment metrics
  metrics <- list(
    total_output = total_output,
    total_employment = total_employment,
    government_output = government_output,
    private_output = private_output,
    private_share = private_share,
    growth_rate = growth_rate,
    high_value_ratio = high_value_ratio,
    recovery_speed = recovery_speed,
    
    # Investment Metrics
    roi_multiplier = if(government_output > 1000) private_output / government_output else
                     if(private_output > 1000) 50 else 0,  # High score for pure private sectors
    
    commercial_velocity = growth_rate * private_share,
    
    manufacturing_export_ratio = high_value_ratio,  # Use high-value ratio as proxy
    
    innovation_factor = case_when(
      district_name %in% c("Professional Services", "Information") ~ high_value_ratio,
      TRUE ~ high_value_ratio * 0.5  # Lower weight for other sectors
    ),
    
    recovery_metric = recovery_speed,
    
    sector_momentum = max(0, growth_rate) * (private_share * 100 + 50)  # Boost all sectors
  )
  
  return(as_tibble(metrics))
}

# Calculate metrics for all BEA districts
bea_investment_results <- analysis_bea_districts %>%
  group_by(district_id, district_name) %>%
  group_modify(~ calculate_bea_district_metrics(.x, .y$district_name[1])) %>%
  ungroup() %>%
  # Calculate composite score
  mutate(
    composite_score = case_when(
      total_output < 500 ~ 0,  # Filter out very small sectors
      TRUE ~ (
        pmin(roi_multiplier, 20) * 0.25 +      # Higher weight on ROI
        pmax(0, pmin(commercial_velocity, 30)) * 0.20 +
        pmin(manufacturing_export_ratio, 100) * 0.15 +
        pmin(innovation_factor, 50) * 0.15 +
        pmin(recovery_metric, 5) * 0.15 +
        pmin(sector_momentum, 100) * 0.10
      )
    )
  ) %>%
  # Handle edge cases
  mutate(across(where(is.numeric), ~ ifelse(is.na(.x) | is.infinite(.x), 0, .x))) %>%
  # Rank districts
  arrange(desc(composite_score)) %>%
  mutate(
    rank = row_number(),
    tier = case_when(
      total_output < 500 ~ "Minimal Activity",
      rank <= 3 ~ "Tier 1 - Investment Magnets", 
      rank <= 6 ~ "Tier 2 - Strong Performers",
      rank <= 9 ~ "Tier 3 - Steady Growth",
      TRUE ~ "Tier 4 - Emerging Sectors"
    )
  )

cat("BEA district investment metrics calculated!\n")
cat("Districts with significant activity:", sum(bea_investment_results$total_output >= 500), "\n")
```

## 10. BEA District Investment Dashboard

```{r bea_dashboard}
# Create professional dashboard for BEA districts
bea_dashboard <- bea_investment_results %>%
  filter(total_output >= 500) %>%  # Only meaningful sectors
  select(
    Rank = rank,
    `Economic Sector` = district_name,
    `Total Output ($M)` = total_output,
    `Employment` = total_employment,
    `ROI Multiplier` = roi_multiplier,
    `Commercial Velocity (%)` = commercial_velocity,
    `High-Value Ratio (%)` = manufacturing_export_ratio,
    `Innovation Factor (%)` = innovation_factor,
    `Recovery Speed` = recovery_metric,
    `Sector Momentum (%)` = sector_momentum,
    `Composite Score` = composite_score,
    Tier = tier
  ) %>%
  mutate(
    `Total Output ($M)` = round(`Total Output ($M)`, 0),
    `Employment` = round(`Employment`, 0),
    `ROI Multiplier` = round(pmin(`ROI Multiplier`, 99), 1),
    `Commercial Velocity (%)` = round(`Commercial Velocity (%)`, 1),
    `High-Value Ratio (%)` = round(`High-Value Ratio (%)`, 1),
    `Innovation Factor (%)` = round(`Innovation Factor (%)`, 1),
    `Recovery Speed` = round(`Recovery Speed`, 2),
    `Sector Momentum (%)` = round(`Sector Momentum (%)`, 1),
    `Composite Score` = round(`Composite Score`, 1)
  ) %>%
  arrange(Rank)

# Display results
cat("BEA SPACE ECONOMY SECTOR ANALYSIS\n")
cat("=================================\n\n")

if(nrow(bea_dashboard) > 0) {
  # Interactive table
  DT::datatable(bea_dashboard,
                caption = "Space Economy Analysis by BEA Economic Sectors",
                options = list(pageLength = 12, scrollX = TRUE)) %>%
    formatStyle("Tier",
                backgroundColor = styleEqual(
                  c("Tier 1 - Investment Magnets", "Tier 2 - Strong Performers", 
                    "Tier 3 - Steady Growth", "Tier 4 - Emerging Sectors"),
                  c("#d4edda", "#fff3cd", "#ffeaa7", "#ddd")
                ))
  
  # Top performing sectors
  cat("TOP 5 SPACE ECONOMY SECTORS:\n")
  top5 <- bea_dashboard %>% head(5)
  
  for(i in 1:nrow(top5)) {
    cat(sprintf("\n#%d: %s\n", i, top5$`Economic Sector`[i]))
    cat(sprintf("   Total Output: $%s M\n", format(top5$`Total Output ($M)`[i], big.mark = ",")))
    cat(sprintf("   Employment: %s\n", format(top5$Employment[i], big.mark = ",")))
    cat(sprintf("   Composite Score: %.1f\n", top5$`Composite Score`[i]))
    
    # Highlight top strength
    strengths <- c()
    if(top5$`ROI Multiplier`[i] > 10) strengths <- c(strengths, sprintf("ROI: %.1fx", top5$`ROI Multiplier`[i]))
    if(top5$`Commercial Velocity (%)`[i] > 5) strengths <- c(strengths, sprintf("Growth: %.1f%%", top5$`Commercial Velocity (%)`[i]))
    if(top5$`Innovation Factor (%)`[i] > 10) strengths <- c(strengths, sprintf("Innovation: %.1f%%", top5$`Innovation Factor (%)`[i]))
    
    if(length(strengths) > 0) {
      cat(sprintf("   Key Strengths: %s\n", paste(head(strengths, 2), collapse = ", ")))
    }
  }
  
  # Export results
  write_csv(bea_investment_results, "bea_district_analysis_complete.csv")
  write_csv(bea_dashboard, "bea_sector_dashboard.csv")
  
  
  # key insights
  top_sector <- bea_dashboard$`Economic Sector`[1]
  top_output <- bea_dashboard$`Total Output ($M)`[1]
  top_employment <- bea_dashboard$Employment[1]
  
  cat(sprintf("• %s leads space economy with $%s M output and %s jobs\n", 
              top_sector, format(top_output, big.mark = ","), format(top_employment, big.mark = ",")))
  
  fastest_growth <- bea_dashboard %>% 
    slice_max(`Commercial Velocity (%)`, n = 1)
  cat(sprintf("• %s shows fastest commercial growth at %.1f%% annually\n",
              fastest_growth$`Economic Sector`[1], fastest_growth$`Commercial Velocity (%)`[1]))
  
  most_innovative <- bea_dashboard %>%
    slice_max(`Innovation Factor (%)`, n = 1)  
  cat(sprintf("• %s has highest innovation intensity at %.1f%%\n",
              most_innovative$`Economic Sector`[1], most_innovative$`Innovation Factor (%)`[1]))
  
  total_space_output <- sum(bea_dashboard$`Total Output ($M)`)
  cat(sprintf("• Total space economy output: $%s M across %d major sectors\n",
              format(total_space_output, big.mark = ","), nrow(bea_dashboard)))
  
} else {
  cat("No sectors found with significant space economy activity\n")
}
```




